# Практическая работа №1. Обработка изображений с использованием библиотеки OpenCV

## Описание программы

Программа представляет собой консольное приложение для обработки изображений. Она содержит мини-библиотеку из 5 фильтров, которые были разработаны 
с помощью базовых операций над изображениями:
- Функция перевода изображения в оттенки серого.
- Функция изменения разрешения изображения.
- Функция применения фотоэффекта сепии к изображению.
- Функция применения фотоэффекта виньетки к изображению.
- Функция пикселизации заданной прямоугольной области изображения.

## Описание функций 
### 1. Описание алгоритма перевода изображения в оттенки серого.

Для перевода изображения в оттенки серого создаём новую одноканальную матрицу полностью заполненную нулями, размер которой равен размеру исходного изображения. Затем во вложенном цикле вычисляем цвет каждого пикселя (BGR) и записываем их сумму в новую переменную, которую после проделанной операции присваиваем соответствующему пикселю новой матрицы. 

Для вычисления цвета пикселя используется формула:
``` math
gr = 0.114 * b + 0.587 * g + 0.299 * r,
```
где 
- `b` - уровень интенсивности синего цвета,
- `g` - уровень интенсивности зелёного цвета,
- `r` - уровень интенсивности красного цвета.

### 2. Описание алгоритма изменения разрешения изображения.

Чтобы изменить размер изображения, вычисляем длину и ширину исходного изображения и умножаем их на коэффициент scale, который задаётся в параметрах функции. Далее создаём трёхканальную матрицу полностью заполненную нулями, размер которой зависит от недавно вычисленных значений длины и ширины. После этого проходимся по вложенному циклу и получаем пиксель исходного изображения с учётом коэффициента scale. Полученное значение присваивается пикселю нового изображения.

``` py
new_img[i, j] = image[int(i / scale), int(j / scale)]
```
Здесь
- `new_img` - новое изображение,
- `image` - исходное изображение.

Таким образом, при увеличении размера изображения некоторые пиксели исходного изображения будут повторяться в новом изображении, а при уменьшении не все пиксели исходного изображения будут учтены.

### 3. Описание алгоритма фотоэффекта сепии к изображению.

Для применения фотоэффекта сепии к изобрвжению создаём новую трёхканальную матрицу полностью заполненную нулями, размер которой равен размеру исходного изображения. После этого во вложенном цикле вычисляем цвет каждого пикселя (BGR). Для фотоэффекта сепии интенсивности красного, зелёного и голубого цветов будут изменяться по формулам:
``` math
tr = 0.393*r + 0.769*g + 0.189*b
```
``` math
tg = 0.349*r + 0.686*g + 0.168*b
```
``` math
tb = 0.272*r + 0.534*g + 0.131*b
```
где
- `r`, `g`, `b` - уровени интенсивности красного, зелёного и синего цветов исходного изображения соответственно,
- `tr`, `tg`, `tb` - уровени интенсивности красного, зелёного и синего цветов нового изображения соответственно.

Затем нужно проверить, чтобы полученные значения интенсивностей находились в диапазоне от 0 до 255. Так как значения интенсивностей цветов в пикселях исходного изображения также находятся в этом диапазоне, а коэффициенты перед ними принимают положительные значения, то полученные интенсивности будут неотприцательными. Поэтому можно проверить только верхнюю границу диапазона и в случае, если значение вышло из диапазона, записать верхнее значение. Далее присваиваем соответствующему пикселю новой матрицы полученные интенсивности.

### 4. Описание алгоритма фотоэффекта виньетки к изображению.

Чтобы применить фотоэффект виньетки к изображению, вычисляем длину и ширину исходного изображения, после чего подсчитываем центральные координаты изображения. Затем создаём копию исходного изображения. После этого проходимся по каждому пикселю и в зависимости от его удалённости от центра изображения по обеим осям подсчитываем коэффициенты по формулам:
``` math
x_{val} = 1 - \frac{|i - x_{center}|}{x_{center}},
```
``` math
y_{val} = 1 - \frac{|j - y_{center}|}{y_{center}}.
```

Итоговый пиксель изображения вычисляем путём произведения текущего пикселя на полученные коэффициенты.

### 5. Описание алгоритма пикселизации заданной прямоугольной области изображения.

Для пикселизации заданной прямоугольной области изображения вычисляем длину и ширину исходного изображения, затем задаём границы области: начальную и конечную координаты по осям x и y:
``` math
x_{start} = \frac{height}{5}, \quad\quad\quad x_{end} = \frac{height}{2.5},
```
``` math
y_{start} = \frac{width}{5}, \quad\quad\quad y_{end} = \frac{width}{2.5},
```
где
- `height` - длина изображения,
- `width` - ширина изображения.

Теперь, зная границы области, создаём её копию. Полученное изображение потребуется разделить на подобласти, размер которых может задать пользователь, так как значение передаётся в параметрах функции. Далее для каждой подобласти вычисляем среднее значение интенсивностей по каждому из трёх каналов, после чего всем пикселям подобласти назначаем полученный цвет.

## Описание команд

Для того, чтобы обработать изображение, в командной строке необходимо указать следующую команду:
```
python cv_lab1.py -i <путь к изображению> -p <название фильтра> -o <название выходного изображения>
```
### Описание аргументов
В командной строке можно использовать следующие аргументы:
- `-i` или `--input`: предназначен для передачи пути к входному изображению. Тип аргумента: `str`.
- `-p` или `--processing`: предназначен для выбора фильтра для обработки изображения. Тип аргумента: `str`. Содержит в себе следующие фильтры:
    - `gray` — используется для перевода изображения в оттенки серого,
    - `resize` — используется для изменения размера изображения,
    - `sepia` — используется для применения фотоэффекта сепии к изображению,
    - `vignette` — используется для применения фотоэффекта виньетки к изображению,
    - `pixelation` — используется для пикселизации прямоугольной области изображения.
- `-sc` или `--scale`: предназначен для хранения коэффициента, который влияет на размер итогового изображения. Тип аргумента: `float`. Параметр не обязательный. Введённое значение будет учитываться только в совокупности с использованием `resize`. Имеет значение по умолчанию `0.5`.
- `-st` или `--step`: предназначен для хранения размера подобласти — будущего пикселя с учётом пикселизации. Тип аргумента: `int`. Параметр не обязательный. Введённое значение будет учитываться только в совокупности с использованием `pixelation`. Имеет значение по умолчанию `20`.
- `-o` или `--output`: предназначен для хранения названия выходного изображения. Тип аргумента: `str`. Имеет значение по умолчанию `output.jpg`.

### Пример использования аргументов
Пример команды для вывода исходного изображения и изображения с применением пикселизации:

```python cv_lab1.py -i photo.jpg -p pixelation -st 15 -o pixel.jpg```

Пример команды для вывода исходного изображения и изображения с применением фотоэфекта сепии:

```python cv_lab1.py -i photo.jpg -p sepia -o sepia.jpg```
